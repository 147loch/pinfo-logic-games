var Sudoku=function(){for(var i=function(i){return i%Sudoku.ROW_COL_SEC_SIZE},n=function(i){return Math.floor(i/Sudoku.ROW_COL_SEC_SIZE)},t=function(n){return Math.floor(n/Sudoku.SEC_GROUP_SIZE)*Sudoku.SEC_GROUP_SIZE+Math.floor(i(n)/Sudoku.GRID_SIZE)*Sudoku.GRID_SIZE},r=function(n){return Math.floor(n/Sudoku.SEC_GROUP_SIZE)*Sudoku.GRID_SIZE+Math.floor(i(n)/Sudoku.GRID_SIZE)},e=function(i){return Sudoku.ROW_COL_SEC_SIZE*i},o=function(i){return i%Sudoku.GRID_SIZE*Sudoku.GRID_SIZE+Math.floor(i/Sudoku.GRID_SIZE)*Sudoku.SEC_GROUP_SIZE},s=function(i,n){return i+Sudoku.ROW_COL_SEC_SIZE*n},q=function(i,n){return i*Sudoku.ROW_COL_SEC_SIZE+n},g=function(i,n){return o(i)+Math.floor(n/Sudoku.GRID_SIZE)*Sudoku.ROW_COL_SEC_SIZE+n%Sudoku.GRID_SIZE},u=function(i){"undefined"!=typeof console&&console.log&&console.log(i)},l=function(i){"undefined"!=typeof process&&process.stdout&&process.stdout.write?process.stdout.write(i):u(i)},a=new Array(Sudoku.BOARD_SIZE),S=new Array(Sudoku.BOARD_SIZE),_=new Array(Sudoku.BOARD_SIZE),c=new Array(Sudoku.POSSIBILITY_SIZE),E=new Array(Sudoku.BOARD_SIZE),I=0;I<Sudoku.BOARD_SIZE;I++)E[I]=I;var f=new Array(Sudoku.ROW_COL_SEC_SIZE);for(I=0;I<Sudoku.ROW_COL_SEC_SIZE;I++)f[I]=I;var w=!1,O=!1,R=[],C=[],v=Sudoku.PrintStyle.READABLE,h=0,L=function(){for(var i=0;i<Sudoku.BOARD_SIZE;i++)S[i]=0;for(i=0;i<Sudoku.BOARD_SIZE;i++)_[i]=0;for(i=0;i<Sudoku.POSSIBILITY_SIZE;i++)c[i]=0;R=[],C=[];for(var n=0;n<Sudoku.BOARD_SIZE;n++)if(a[n]>0){var t=a[n]-1,r=s(t,n),e=a[n];if(0!=c[r])return!1;H.call(this,n,1,e),(O||w)&&V.call(this,new this.LogItem(1,Sudoku.LogType.GIVEN,e,n))}return!0},y=function(i){return!!p.call(this,i)||(!!d.call(this,i)||(!!D.call(this,i)||(!!N.call(this,i)||(!!b.call(this,i)||(!!m.call(this,i)||(!!G.call(this,i)||(!!A.call(this,i)||(!!W.call(this,i)||(!!z.call(this,i)||(!!B.call(this,i)||!!M.call(this,i)))))))))))},p=function(i){for(var n=0;n<Sudoku.BOARD_SIZE;n++)if(0==S[n]){for(var t=0,r=0,e=0;e<Sudoku.ROW_COL_SEC_SIZE;e++){var o=s(e,n);0==c[o]&&(t++,r=e+1)}if(1==t)return H.call(this,n,i,r),(O||w)&&V.call(this,new this.LogItem(i,Sudoku.LogType.SINGLE,r,n)),!0}return!1},D=function(i){for(var n=0;n<Sudoku.ROW_COL_SEC_SIZE;n++)for(var t=0;t<Sudoku.ROW_COL_SEC_SIZE;t++){for(var r=0,e=0,o=0;o<Sudoku.ROW_COL_SEC_SIZE;o++){var q=n*Sudoku.ROW_COL_SEC_SIZE+o,g=s(t,q);0==c[g]&&(r++,e=q)}if(1==r){var u=t+1;return(O||w)&&V.call(this,new this.LogItem(i,Sudoku.LogType.HIDDEN_SINGLE_ROW,u,e)),H.call(this,e,i,u),!0}}return!1},N=function(i){for(var n=0;n<Sudoku.ROW_COL_SEC_SIZE;n++)for(var t=0;t<Sudoku.ROW_COL_SEC_SIZE;t++){for(var r=0,e=0,o=0;o<Sudoku.ROW_COL_SEC_SIZE;o++){var g=q(o,n),u=s(t,g);0==c[u]&&(r++,e=g)}if(1==r){var l=t+1;return(O||w)&&V.call(this,new this.LogItem(i,Sudoku.LogType.HIDDEN_SINGLE_COLUMN,l,e)),H.call(this,e,i,l),!0}}return!1},d=function(i){for(var n=0;n<Sudoku.ROW_COL_SEC_SIZE;n++)for(var t=o(n),r=0;r<Sudoku.ROW_COL_SEC_SIZE;r++){for(var e=0,q=0,g=0;g<Sudoku.GRID_SIZE;g++)for(var u=0;u<Sudoku.GRID_SIZE;u++){var l=t+g+Sudoku.ROW_COL_SEC_SIZE*u,a=s(r,l);0==c[a]&&(e++,q=l)}if(1==e){var S=r+1;return(O||w)&&V.call(this,new this.LogItem(i,Sudoku.LogType.HIDDEN_SINGLE_SECTION,S,q)),H.call(this,q,i,S),!0}}return!1},Z=function(i,n){for(var t=0,r=k.call(this),e=0;e<Sudoku.ROW_COL_SEC_SIZE;e++){var o=f[e],q=s(o,r);if(0==c[q]){if(t==n){var g=o+1;return(O||w)&&V.call(this,new this.LogItem(i,Sudoku.LogType.GUESS,g,r)),H.call(this,r,i,g),!0}t++}}return!1},P=function(){for(var i=0;i<Sudoku.BOARD_SIZE;i++)if(0==S[i]){for(var n=0,t=0;t<Sudoku.ROW_COL_SEC_SIZE;t++){var r=s(t,i);0==c[r]&&n++}if(0==n)return!0}return!1},T=function(i){(O||w)&&V.call(this,new this.LogItem(i,Sudoku.LogType.ROLLBACK));for(var n=0;n<Sudoku.BOARD_SIZE;n++)_[n]==i&&(_[n]=0,S[n]=0);for(n=0;n<Sudoku.POSSIBILITY_SIZE;n++)c[n]==i&&(c[n]=0);for(;C.length>0&&C[C.length-1]==i;)C.pop()},m=function(i){for(var t=0;t<Sudoku.ROW_COL_SEC_SIZE;t++)for(var q=0;q<Sudoku.ROW_COL_SEC_SIZE;q++){for(var g=o(q),u=!0,l=-1,a=0;a<Sudoku.GRID_SIZE;a++)for(var S=0;S<Sudoku.GRID_SIZE;S++){var _=g+S+Sudoku.ROW_COL_SEC_SIZE*a,E=s(t,_);0==c[E]&&(-1==l||l==a?l=a:u=!1)}if(u&&-1!=l){var I=!1,f=n(g)+l,R=e(f);for(S=0;S<Sudoku.ROW_COL_SEC_SIZE;S++){var C=R+S,v=r(C);E=s(t,C);q!=v&&0==c[E]&&(c[E]=i,I=!0)}if(I)return(O||w)&&V.call(this,new this.LogItem(i,Sudoku.LogType.POINTING_PAIR_TRIPLE_ROW,t+1,R)),!0}}return!1},A=function(r){for(var o=0;o<Sudoku.ROW_COL_SEC_SIZE;o++)for(var g=0;g<Sudoku.ROW_COL_SEC_SIZE;g++){for(var u=e(g),l=!0,a=-1,S=0;S<Sudoku.GRID_SIZE;S++)for(var _=0;_<Sudoku.GRID_SIZE;_++){var E=S*Sudoku.GRID_SIZE+_,I=q(g,E),f=s(o,I);0==c[f]&&(-1==a||a==S?a=S:l=!1)}if(l&&-1!=a){var R=!1,C=(E=Sudoku.GRID_SIZE*a,t(q(g,E))),v=n(C),h=i(C);for(S=0;S<Sudoku.GRID_SIZE;S++)for(_=0;_<Sudoku.GRID_SIZE;_++){var L=v+S;I=q(L,h+_),f=s(o,I);g!=L&&0==c[f]&&(c[f]=r,R=!0)}if(R)return(O||w)&&V.call(this,new this.LogItem(r,Sudoku.LogType.ROW_BOX,o+1,u)),!0}}return!1},W=function(r){for(var o=0;o<Sudoku.ROW_COL_SEC_SIZE;o++)for(var g=0;g<Sudoku.ROW_COL_SEC_SIZE;g++){for(var u=e(g),l=!0,a=-1,S=0;S<Sudoku.GRID_SIZE;S++)for(var _=0;_<Sudoku.GRID_SIZE;_++){var E=S*Sudoku.GRID_SIZE+_,I=q(g,E),f=s(o,I);0==c[f]&&(-1==a||a==S?a=S:l=!1)}if(l&&-1!=a){var R=!1,C=(E=Sudoku.GRID_SIZE*a,t(q(g,E))),v=n(C),h=i(C);for(S=0;S<Sudoku.GRID_SIZE;S++)for(_=0;_<Sudoku.GRID_SIZE;_++){var L=v+S;I=q(L,h+_),f=s(o,I);g!=L&&0==c[f]&&(c[f]=r,R=!0)}if(R)return(O||w)&&V.call(this,new this.LogItem(r,Sudoku.LogType.ROW_BOX,o+1,u)),!0}}return!1},G=function(n){for(var t=0;t<Sudoku.ROW_COL_SEC_SIZE;t++)for(var e=0;e<Sudoku.ROW_COL_SEC_SIZE;e++){for(var q=o(e),g=!0,u=-1,l=0;l<Sudoku.GRID_SIZE;l++)for(var a=0;a<Sudoku.GRID_SIZE;a++){var S=q+l+Sudoku.ROW_COL_SEC_SIZE*a,_=s(t,S);0==c[_]&&(-1==u||u==l?u=l:g=!1)}if(g&&-1!=u){var E=!1,I=i(q)+u,f=I;for(l=0;l<Sudoku.ROW_COL_SEC_SIZE;l++){var R=f+Sudoku.ROW_COL_SEC_SIZE*l,C=r(R);_=s(t,R);e!=C&&0==c[_]&&(c[_]=n,E=!0)}if(E)return(O||w)&&V.call(this,new this.LogItem(n,Sudoku.LogType.POINTING_PAIR_TRIPLE_COLUMN,t+1,f)),!0}}return!1},z=function(i){for(var n=0;n<Sudoku.ROW_COL_SEC_SIZE;n++)for(var t=0;t<Sudoku.ROW_COL_SEC_SIZE;t++){for(var r=-1,e=-1,o=0,g=0;g<Sudoku.ROW_COL_SEC_SIZE;g++){var u=q(n,g),l=s(t,u);0==c[l]&&(-1==r||r==g?r=g:-1!=e&&e!=g||(e=g),o++)}if(2==o)for(var a=t+1;a<Sudoku.ROW_COL_SEC_SIZE;a++){var S=-1,_=-1,E=0;for(g=0;g<Sudoku.ROW_COL_SEC_SIZE;g++){u=q(n,g),l=s(a,u);0==c[l]&&(-1==S||S==g?S=g:-1!=_&&_!=g||(_=g),E++)}if(2==E&&r==S&&e==_){for(var I=!1,f=0;f<Sudoku.ROW_COL_SEC_SIZE;f++)if(f!=t&&f!=a){var R=q(n,r),C=q(n,e),v=s(f,R),h=s(f,C);0==c[v]&&(c[v]=i,I=!0),0==c[h]&&(c[h]=i,I=!0)}if(I)return(O||w)&&V.call(this,new this.LogItem(i,Sudoku.LogType.HIDDEN_PAIR_ROW,t+1,q(n,r))),!0}}}return!1},B=function(i){for(var n=0;n<Sudoku.ROW_COL_SEC_SIZE;n++)for(var t=0;t<Sudoku.ROW_COL_SEC_SIZE;t++){for(var r=-1,e=-1,o=0,g=0;g<Sudoku.ROW_COL_SEC_SIZE;g++){var u=q(g,n),l=s(t,u);0==c[l]&&(-1==r||r==g?r=g:-1!=e&&e!=g||(e=g),o++)}if(2==o)for(var a=t+1;a<Sudoku.ROW_COL_SEC_SIZE;a++){var S=-1,_=-1,E=0;for(g=0;g<Sudoku.ROW_COL_SEC_SIZE;g++){u=q(g,n),l=s(a,u);0==c[l]&&(-1==S||S==g?S=g:-1!=_&&_!=g||(_=g),E++)}if(2==E&&r==S&&e==_){for(var I=!1,f=0;f<Sudoku.ROW_COL_SEC_SIZE;f++)if(f!=t&&f!=a){var R=q(r,n),C=q(e,n),v=s(f,R),h=s(f,C);0==c[v]&&(c[v]=i,I=!0),0==c[h]&&(c[h]=i,I=!0)}if(I)return(O||w)&&V.call(this,new this.LogItem(i,Sudoku.LogType.HIDDEN_PAIR_COLUMN,t+1,q(r,n))),!0}}}return!1},M=function(i){for(var n=0;n<Sudoku.ROW_COL_SEC_SIZE;n++)for(var t=0;t<Sudoku.ROW_COL_SEC_SIZE;t++){for(var r=-1,e=-1,o=0,q=0;q<Sudoku.ROW_COL_SEC_SIZE;q++){var u=g(n,q),l=s(t,u);0==c[l]&&(-1==r||r==q?r=q:-1!=e&&e!=q||(e=q),o++)}if(2==o)for(var a=t+1;a<Sudoku.ROW_COL_SEC_SIZE;a++){var S=-1,_=-1,E=0;for(q=0;q<Sudoku.ROW_COL_SEC_SIZE;q++){u=g(n,q),l=s(a,u);0==c[l]&&(-1==S||S==q?S=q:-1!=_&&_!=q||(_=q),E++)}if(2==E&&r==S&&e==_){for(var I=!1,f=0;f<Sudoku.ROW_COL_SEC_SIZE;f++)if(f!=t&&f!=a){var R=g(n,r),C=g(n,e),v=s(f,R),h=s(f,C);0==c[v]&&(c[v]=i,I=!0),0==c[h]&&(c[h]=i,I=!0)}if(I)return(O||w)&&V.call(this,new this.LogItem(i,Sudoku.LogType.HIDDEN_PAIR_SECTION,t+1,g(n,r))),!0}}}return!1},H=function(r,e,o){if(0!=S[r])throw"Marking position that already has been marked.";if(0!=_[r])throw"Marking position that was marked another round.";var q=o-1;S[r]=o;var g=s(q,r);if(0!=c[g])throw"Marking impossible position.";_[r]=e;for(var u=n(r)*Sudoku.ROW_COL_SEC_SIZE,l=0;l<Sudoku.ROW_COL_SEC_SIZE;l++){var a=s(q,u+l);0==c[a]&&(c[a]=e)}for(var E=i(r),I=0;I<Sudoku.ROW_COL_SEC_SIZE;I++){var f=E+Sudoku.ROW_COL_SEC_SIZE*I;a=s(q,f);0==c[a]&&(c[a]=e)}var w=t(r);for(I=0;I<Sudoku.GRID_SIZE;I++)for(var O=0;O<Sudoku.GRID_SIZE;O++){var R=w+I+Sudoku.ROW_COL_SEC_SIZE*O;a=s(q,R);0==c[a]&&(c[a]=e)}for(q=0;q<Sudoku.ROW_COL_SEC_SIZE;q++){a=s(q,r);0==c[a]&&(c[a]=e)}},k=function(){for(var i=10,n=0,t=0;t<Sudoku.BOARD_SIZE;t++){var r=E[t];if(0==S[r]){for(var e=0,o=0;o<Sudoku.ROW_COL_SEC_SIZE;o++){var q=s(o,r);0==c[q]&&e++}e<i&&(i=e,n=r)}}return n},b=function(r){for(var e=0;e<Sudoku.BOARD_SIZE;e++){if(2==U(e))for(var o=n(e),s=i(e),g=t(e),u=e;u<Sudoku.BOARD_SIZE;u++){if(e!=u)if(2==U(u)&&K(e,u)){if(o==n(u)){for(var l=!1,a=0;a<Sudoku.ROW_COL_SEC_SIZE;a++){(I=q(o,a))!=e&&I!=u&&J(e,I,r)&&(l=!0)}if(l)return(O||w)&&V.call(this,new this.LogItem(r,Sudoku.LogType.NAKED_PAIR_ROW,0,e)),!0}if(s==i(u)){l=!1;for(var S=0;S<Sudoku.ROW_COL_SEC_SIZE;S++){(I=q(S,s))!=e&&I!=u&&J(e,I,r)&&(l=!0)}if(l)return(O||w)&&V.call(this,new this.LogItem(r,Sudoku.LogType.NAKED_PAIR_COLUMN,0,e)),!0}if(g==t(u)){l=!1;for(var _=t(e),c=0;c<Sudoku.GRID_SIZE;c++)for(var E=0;E<Sudoku.GRID_SIZE;E++){var I;(I=_+c+Sudoku.ROW_COL_SEC_SIZE*E)!=e&&I!=u&&J(e,I,r)&&(l=!0)}if(l)return(O||w)&&V.call(this,new this.LogItem(r,Sudoku.LogType.NAKED_PAIR_SECTION,0,e)),!0}}}}return!1},U=function(i){for(var n=0,t=0;t<Sudoku.ROW_COL_SEC_SIZE;t++){var r=s(t,i);0==c[r]&&n++}return n},K=function(i,n){for(var t=0;t<Sudoku.ROW_COL_SEC_SIZE;t++){var r=s(t,i),e=s(t,n);if(!(0!=c[r]&&0!=c[e]||0==c[r]&&0==c[e]))return!1}return!0},V=function(i){O&&i.print(),w&&(R.push(i),C.push(i))},X=function(){Q(E,Sudoku.BOARD_SIZE),Q(f,Sudoku.ROW_COL_SEC_SIZE)},x=function(i){l(Y.call(this,i))},Y=function(i){for(var n="",t=0;t<Sudoku.BOARD_SIZE;t++)v==Sudoku.PrintStyle.READABLE&&(n+=" "),0==i[t]?n+=".":n+=i[t],t==Sudoku.BOARD_SIZE-1?(v==Sudoku.PrintStyle.CSV?n+=",":n+="\n",v!=Sudoku.PrintStyle.READABLE&&v!=Sudoku.PrintStyle.COMPACT||(n+="\n")):t%Sudoku.ROW_COL_SEC_SIZE==Sudoku.ROW_COL_SEC_SIZE-1?(v!=Sudoku.PrintStyle.READABLE&&v!=Sudoku.PrintStyle.COMPACT||(n+="\n"),t%Sudoku.SEC_GROUP_SIZE==Sudoku.SEC_GROUP_SIZE-1&&v==Sudoku.PrintStyle.READABLE&&(n+="-------|-------|-------\n")):t%Sudoku.GRID_SIZE==Sudoku.GRID_SIZE-1&&v==Sudoku.PrintStyle.READABLE&&(n+=" |");return n},F=function(i){l(j(i))},j=function(i){var n="";w||(n+="History was not recorded.",v==Sudoku.PrintStyle.CSV?n+=" -- ":n+="\n");for(var t=0;t<i.length;t++)n+=t+1+". "+i[t].toString(),v==Sudoku.PrintStyle.CSV?n+=" -- ":n+="\n";return v==Sudoku.PrintStyle.CSV?n+=",":n+="\n",n},J=function(i,n,t){for(var r=!1,e=0;e<Sudoku.ROW_COL_SEC_SIZE;e++){var o=s(e,i),q=s(e,n);0==c[o]&&0==c[q]&&(c[q]=t,r=!0)}return r},Q=function(i,n){for(var t=0;t<n;t++){var r=n-t,e=Math.floor(Math.random()*r)+t,o=i[t];i[t]=i[e],i[e]=o}},$=function(i,n){for(var t=0,r=0;r<i.length;r++)i[r].getType()==n&&t++;return t};this.LogItem=function(t,r,e,o){var s=t,q=r,g=e,l=o;this.getRound=function(){return s},this.print=function(){u(this.toString())},this.getType=function(){return q},this.getColumn=function(){return-1==l?-1:i(l)},this.getRow=function(){return-1==l?-1:n(l)},this.getPosition=function(){return l},this.getValue=function(){return g},this.getDescription=function(){switch(this.getType()){case Sudoku.LogType.GIVEN:return"Mark given";case Sudoku.LogType.ROLLBACK:return"Roll back round";case Sudoku.LogType.GUESS:return"Mark guess (start round)";case Sudoku.LogType.HIDDEN_SINGLE_ROW:return"Mark single possibility for value in row";case Sudoku.LogType.HIDDEN_SINGLE_COLUMN:return"Mark single possibility for value in column";case Sudoku.LogType.HIDDEN_SINGLE_SECTION:return"Mark single possibility for value in section";case Sudoku.LogType.SINGLE:return"Mark only possibility for cell";case Sudoku.LogType.NAKED_PAIR_ROW:return"Remove possibilities for naked pair in row";case Sudoku.LogType.NAKED_PAIR_COLUMN:return"Remove possibilities for naked pair in column";case Sudoku.LogType.NAKED_PAIR_SECTION:return"Remove possibilities for naked pair in section";case Sudoku.LogType.POINTING_PAIR_TRIPLE_ROW:return"Remove possibilities for row because all values are in one section";case Sudoku.LogType.POINTING_PAIR_TRIPLE_COLUMN:return"Remove possibilities for column because all values are in one section";case Sudoku.LogType.ROW_BOX:return"Remove possibilities for section because all values are in one row";case Sudoku.LogType.COLUMN_BOX:return"Remove possibilities for section because all values are in one column";case Sudoku.LogType.HIDDEN_PAIR_ROW:return"Remove possibilities from hidden pair in row";case Sudoku.LogType.HIDDEN_PAIR_COLUMN:return"Remove possibilities from hidden pair in column";case Sudoku.LogType.HIDDEN_PAIR_SECTION:return"Remove possibilities from hidden pair in section";default:return"!!! Performed unknown optimization !!!"}},this.toString=function(){var t="Round: "+this.getRound()+" - ";if(t+=this.getDescription(),g>0||l>-1){t+=" (";var r=!1;l>-1&&(r&&(t+=" - "),t+="Row: "+(n(l)+1)+" - Column: "+(i(l)+1),r=!0),g>0&&(r&&(t+=" - "),t+="Value: "+g,r=!0),t+=")"}return t}},this.setPuzzle=function(i){for(var n=0;n<Sudoku.BOARD_SIZE;n++)a[n]=i[n];return L.call(this)},this.printPuzzle=function(){return x.call(this,a)},this.getPuzzleString=function(){return Y.call(this,a)},this.printSolution=function(){return x.call(this,S)},this.getSolutionString=function(){return Y.call(this,S)},this.solve=function(i){if(!i||i<=1)return L.call(this),X(),this.solve(2);for(h=i;y.call(this,i);){if(this.isSolved())return!0;if(P.call(this))return!1}for(var n=i+1,t=i+2,r=0;Z.call(this,n,r);r++){if(!P.call(this)&&this.solve(t))return!0;T.call(this,t),T.call(this,n)}return!1},this.countSolutions=function(i,n){if(!i||i<=1){var t=w;this.setRecordHistory(!1);var r=O;this.setLogHistory(!1),L.call(this);var e=this.countSolutions(2,!1);return this.setRecordHistory(t),this.setLogHistory(r),e}for(;y.call(this,i);){if(this.isSolved())return T.call(this,i),1;if(P.call(this))return T.call(this,i),0}for(var o=0,s=i+1,q=0;Z.call(this,s,q);q++)if(o+=this.countSolutions(s,n),n&&o>=2)return T.call(this,i),o;return T.call(this,i),o},this.isSolved=function(){for(var i=0;i<Sudoku.BOARD_SIZE;i++)if(0==S[i])return!1;return!0},this.getSolveHistory=function(){return this.isSolved()?R:"No solve history - Puzzle is not possible to solve."},this.getSolveHistoryString=function(){return this.isSolved()?j.call(this,R):"No solve history - Puzzle is not possible to solve."},this.printSolveHistory=function(){this.isSolved()?F(R):u("No solve history - Puzzle is not possible to solve.")},this.setRecordHistory=function(i){w=i},this.setLogHistory=function(i){O=i},this.setPrintStyle=function(i){v=i},this.generatePuzzle=function(){return this.generatePuzzleSymmetry(Sudoku.Symmetry.NONE)},this.generatePuzzleSymmetry=function(t){t==Sudoku.Symmetry.RANDOM&&(t=function(){var i=Math.floor(4*Math.random());switch(i){case 0:return Sudoku.Symmetry.ROTATE90;case 1:return Sudoku.Symmetry.ROTATE180;case 2:return Sudoku.Symmetry.MIRROR;case 3:return Sudoku.Symmetry.FLIP}throw"Unexpected random value: "+i}.call(this));var r=w;this.setRecordHistory(!1);var e=O;this.setLogHistory(!1),function(){for(var i=0;i<Sudoku.BOARD_SIZE;i++)a[i]=0;L.call(this)}.call(this),X.call(this),this.solve(),t==Sudoku.Symmetry.NONE&&function(){for(var i=2;i<=h;i+=2)T.call(this,i)}.call(this);for(var o=0;o<Sudoku.BOARD_SIZE;o++)a[o]=S[o];X.call(this);for(o=0;o<Sudoku.BOARD_SIZE;o++){var s=E[o];if(a[s]>0){var g=-1,u=-1,l=-1;switch(t){case Sudoku.Symmetry.ROTATE90:u=q(Sudoku.ROW_COL_SEC_SIZE-1-i(s),n(s)),l=q(i(s),Sudoku.ROW_COL_SEC_SIZE-1-n(s));case Sudoku.Symmetry.ROTATE180:g=q(Sudoku.ROW_COL_SEC_SIZE-1-n(s),Sudoku.ROW_COL_SEC_SIZE-1-i(s));break;case Sudoku.Symmetry.MIRROR:g=q(n(s),Sudoku.ROW_COL_SEC_SIZE-1-i(s));break;case Sudoku.Symmetry.FLIP:g=q(Sudoku.ROW_COL_SEC_SIZE-1-n(s),i(s))}var _=a[s];a[s]=0;var c=0;g>=0&&(c=a[g],a[g]=0);var I=0;u>=0&&(I=a[u],a[u]=0);var f=0;l>=0&&(f=a[l],a[l]=0),L.call(this),this.countSolutions(2,!0)>1&&(a[s]=_,g>=0&&0!=c&&(a[g]=c),u>=0&&0!=I&&(a[u]=I),l>=0&&0!=f&&(a[l]=f))}}return L.call(this),this.setRecordHistory(r),this.setLogHistory(e),!0},this.getGivenCount=function(){for(var i=0,n=0;n<Sudoku.BOARD_SIZE;n++)0!=a[n]&&i++;return i},this.getSingleCount=function(){return $.call(this,C,Sudoku.LogType.SINGLE)},this.getHiddenSingleCount=function(){return $.call(this,C,Sudoku.LogType.HIDDEN_SINGLE_ROW)+$.call(this,C,Sudoku.LogType.HIDDEN_SINGLE_COLUMN)+$.call(this,C,Sudoku.LogType.HIDDEN_SINGLE_SECTION)},this.getNakedPairCount=function(){return $.call(this,C,Sudoku.LogType.NAKED_PAIR_ROW)+$.call(this,C,Sudoku.LogType.NAKED_PAIR_COLUMN)+$.call(this,C,Sudoku.LogType.NAKED_PAIR_SECTION)},this.getHiddenPairCount=function(){return $.call(this,C,Sudoku.LogType.HIDDEN_PAIR_ROW)+$.call(this,C,Sudoku.LogType.HIDDEN_PAIR_COLUMN)+$.call(this,C,Sudoku.LogType.HIDDEN_PAIR_SECTION)},this.getBoxLineReductionCount=function(){return $.call(this,C,Sudoku.LogType.ROW_BOX)+$.call(this,C,Sudoku.LogType.COLUMN_BOX)},this.getPointingPairTripleCount=function(){return $.call(this,C,Sudoku.LogType.POINTING_PAIR_TRIPLE_ROW)+$.call(this,C,Sudoku.LogType.POINTING_PAIR_TRIPLE_COLUMN)},this.getGuessCount=function(){return $.call(this,C,Sudoku.LogType.GUESS)},this.getBacktrackCount=function(){return $.call(this,R,Sudoku.LogType.ROLLBACK)},this.getSolveInstructions=function(){return this.isSolved()?C:"No solve instructions - Puzzle is not possible to solve."},this.getSolveInstructionsString=function(){return this.isSolved()?j.call(this,C):"No solve instructions - Puzzle is not possible to solve."},this.printSolveInstructions=function(){this.isSolved()?F(C):u("No solve instructions - Puzzle is not possible to solve.")},this.getDifficulty=function(){return this.getGuessCount()>0?Sudoku.Difficulty.EXPERT:this.getBoxLineReductionCount()>0?Sudoku.Difficulty.INTERMEDIATE:this.getPointingPairTripleCount()>0?Sudoku.Difficulty.INTERMEDIATE:this.getHiddenPairCount()>0?Sudoku.Difficulty.INTERMEDIATE:this.getNakedPairCount()>0?Sudoku.Difficulty.INTERMEDIATE:this.getHiddenSingleCount()>0?Sudoku.Difficulty.EASY:this.getSingleCount()>0?Sudoku.Difficulty.SIMPLE:Sudoku.Difficulty.UNKNOWN},this.getDifficultyAsString=function(){switch(this.getDifficulty()){case Sudoku.Difficulty.EXPERT:return"Expert";case Sudoku.Difficulty.INTERMEDIATE:return"Intermediate";case Sudoku.Difficulty.EASY:return"Easy";case Sudoku.Difficulty.SIMPLE:return"Simple";default:return"Unknown"}}};function getMicroseconds(){return 1e3*(new Date).getTime()}Sudoku.PrintStyle={ONE_LINE:0,COMPACT:1,READABLE:2,CSV:3},Sudoku.Difficulty={UNKNOWN:0,SIMPLE:1,EASY:2,INTERMEDIATE:3,EXPERT:4},Sudoku.Symmetry={NONE:0,ROTATE90:1,ROTATE180:2,MIRROR:3,FLIP:4,RANDOM:5},Sudoku.LogType={GIVEN:0,SINGLE:1,HIDDEN_SINGLE_ROW:2,HIDDEN_SINGLE_COLUMN:3,HIDDEN_SINGLE_SECTION:4,GUESS:5,ROLLBACK:6,NAKED_PAIR_ROW:7,NAKED_PAIR_COLUMN:8,NAKED_PAIR_SECTION:9,POINTING_PAIR_TRIPLE_ROW:10,POINTING_PAIR_TRIPLE_COLUMN:11,ROW_BOX:12,COLUMN_BOX:13,HIDDEN_PAIR_ROW:14,HIDDEN_PAIR_COLUMN:15,HIDDEN_PAIR_SECTION:16},Sudoku.GRID_SIZE=3,Sudoku.ROW_COL_SEC_SIZE=Sudoku.GRID_SIZE*Sudoku.GRID_SIZE,Sudoku.SEC_GROUP_SIZE=Sudoku.ROW_COL_SEC_SIZE*Sudoku.GRID_SIZE,Sudoku.BOARD_SIZE=Sudoku.ROW_COL_SEC_SIZE*Sudoku.ROW_COL_SEC_SIZE,Sudoku.POSSIBILITY_SIZE=Sudoku.BOARD_SIZE*Sudoku.ROW_COL_SEC_SIZE;var puzzleStartTime,workingButton=null;function generateNum(i,n){if(workingButton)if(n>0){if(i.Sudoku.setRecordHistory(i.printHistory||i.printInstructions||i.printStats||i.difficulty!=Sudoku.Difficulty.UNKNOWN),i.Sudoku.setPrintStyle(i.printStyle),i.Sudoku.generatePuzzleSymmetry(i.symmetry),(i.printSolution||i.printHistory||i.printStats||i.printInstructions||i.difficulty!=Sudoku.Difficulty.UNKNOWN)&&i.Sudoku.solve(),i.difficulty==Sudoku.Difficulty.UNKNOWN||i.difficulty==i.Sudoku.getDifficulty()){i.doneCount++;var t=i.Sudoku.getPuzzleString();i.printSolution&&(t+=i.Sudoku.getSolutionString()),i.printHistory&&(t+=i.Sudoku.getSolveHistoryString()),i.printInstructions&&(t+=i.Sudoku.getSolveInstructionsString());var r=getMicroseconds();if(i.timer){var e=(r-puzzleStartTime)/1e3;i.printStyle==Sudoku.PrintStyle.CSV?t+=e+",":t+="Time: "+e+" milliseconds\n",puzzleStartTime=r}i.printStats&&(t+=stats(i)),addOutput(t+="\n"),n--}setTimeout(function(){generateNum(i,n)},0)}else{var o=getMicroseconds();if(i.timer){e=(o-i.applicationStartTime)/1e6;addOutput(i.doneCount+" puzzle"+(1==i.doneCount?"":"s")+" generated in "+e+" seconds.")}clearWorking("Generate")}}function clearWorking(i){setError(""),workingButton&&i&&(workingButton.value=i,workingButton=null),el("loader").classList.remove("active")}function el(i){return document.getElementById(i)}function startWork(i){el("output").innerHTML="",i&&(i.value="Stop",workingButton=i),el("loader").classList.add("active")}function setError(i){""===i?el("errorParent").classList.add("hidden"):(el("error").innerHTML=i,el("errorParent").classList.remove("hidden"))}function addOutput(i){el("output").appendChild(document.createTextNode(i))}function getOptData(i){return{printSolution:i.printsolution&&i.printsolution.checked,printPuzzle:i.printpuzzle&&i.printpuzzle.checked,printHistory:i.printhistory.checked,printInstructions:i.printinstructions.checked,timer:i.timer.checked,countSolutions:i.countsolutions&&i.countsolutions.checked,printStyle:parseInt(i.outputselect.value),printStats:i.printstats.checked,difficulty:i.difficultyselect?parseInt(i.difficultyselect.value):0,symmetry:i.symmetryselect?parseInt(i.symmetryselect.value):0,applicationStartTime:getMicroseconds(),Sudoku:new Sudoku,doneCount:0}}function csvHeader(i,n,t){var r="";return n&&(r+="Puzzle,"),t&&(r+="Solution,"),i.printHistory&&(r+="Solve History,"),i.printInstructions&&(r+="Solve Instructions,"),i.timer&&(r+="Time (milliseconds),"),i.printStats&&(r+="Givens,Singles,Hidden Singles,Naked Pairs,Hidden Pairs,Pointing Pairs/Triples,Box/Line Intersections,Guesses,Backtracks,Difficulty"),r+="\n"}function stats(i){var n="",t=i.Sudoku.getGivenCount(),r=i.Sudoku.getSingleCount(),e=i.Sudoku.getHiddenSingleCount(),o=i.Sudoku.getNakedPairCount(),s=i.Sudoku.getHiddenPairCount(),q=i.Sudoku.getPointingPairTripleCount(),g=i.Sudoku.getBoxLineReductionCount(),u=i.Sudoku.getGuessCount(),l=i.Sudoku.getBacktrackCount(),a=i.Sudoku.getDifficultyAsString();return i.printStyle==Sudoku.PrintStyle.CSV?n+=t+","+r+","+e+","+o+","+s+","+q+","+g+","+u+","+l+","+a+",":(n+="Number of Givens: "+t+"\n",n+="Number of Singles: "+r+"\n",n+="Number of Hidden Singles: "+e+"\n",n+="Number of Naked Pairs: "+o+"\n",n+="Number of Hidden Pairs: "+s+"\n",n+="Number of Pointing Pairs/Triples: "+q+"\n",n+="Number of Box/Line Intersections: "+g+"\n",n+="Number of Guesses: "+u+"\n",n+="Number of Backtracks: "+l+"\n",n+="Difficulty: "+a+"\n"),n}function generate(i){if(clearWorking(),workingButton)clearWorking("Generate");else{startWork(i.generatebutton);var n=getOptData(i);n.printStyle==Sudoku.PrintStyle.CSV&&addOutput(csvHeader(n,!0,n.printSolution)),puzzleStartTime=getMicroseconds(),generateNum(n,i.generatenumber.value)}}function solve(i){if(clearWorking(),workingButton)clearWorking("Solve");else{var n=getOptData(i),t=getPuzzles(i.tosolve.value);if(!t.length)return setError("No puzzles were found. Puzzles must be 81 numbers with zeros or periods for the unknowns.<br>For example:<br><br><code><pre>.47..2....18.5.7.4..59...2...............9..2....713.9.72....3...1......5.38.....</pre></code>");startWork(i.solvebutton),n.printStyle==Sudoku.PrintStyle.CSV&&addOutput(csvHeader(n,n.printPuzzle,!0)),solveNum(n,t)}}function solveNum(i,n){if(workingButton)if(i.doneCount<n.length){puzzleStartTime=getMicroseconds(),i.Sudoku.setRecordHistory(i.printHistory||i.printInstructions||i.printStats||i.difficulty!=Sudoku.Difficulty.UNKNOWN),i.Sudoku.setPrintStyle(i.printStyle),i.Sudoku.setPuzzle(n[i.doneCount]),i.Sudoku.solve();var t="";if(i.printPuzzle&&(t+=i.Sudoku.getPuzzleString()),i.Sudoku.isSolved()){if(t+=i.Sudoku.getSolutionString(),i.printHistory&&(t+=i.Sudoku.getSolveHistoryString()),i.printInstructions&&(t+=i.Sudoku.getSolveInstructionsString()),i.countSolutions){var r=i.Sudoku.countSolutions();i.printStyle==Sudoku.PrintStyle.CSV?t+=r+",":t+=1==r?"solution to the puzzle is unique.\n":"There are "+r+" solutions to the puzzle.\n"}var e=getMicroseconds();if(i.timer){var o=(e-puzzleStartTime)/1e3;i.printStyle==Sudoku.PrintStyle.CSV?t+=o+",":t+="Time: "+o+" milliseconds\n"}i.printStats&&(t+=stats(i)),t+="\n"}else t+="Puzzle has no solution.",t+=printStyle==Sudoku.PrintStyle.CSV?",":"\n";addOutput(t),i.doneCount++,setTimeout(function(){solveNum(i,n)},0)}else{var s=getMicroseconds();if(i.timer){o=(s-i.applicationStartTime)/1e6;addOutput(i.doneCount+" puzzle"+(1==i.doneCount?"":"s")+" in "+o+" seconds.")}clearWorking("Solve")}}function getPuzzles(i){for(var n=[],t=[],r=0;r<i.length;r++){var e=i.charAt(r);e[0]>="1"&&e[0]<="9"&&t.push(e-"0"),"."!=e[0]&&"0"!=e[0]||t.push(0),t.length==Sudoku.BOARD_SIZE&&(n.push(t),t=[])}return n}